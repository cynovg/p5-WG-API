image: perl

stages:
  - test
  - release

test:
    stage: test
    before_script:
      - perl -V
      - cpan install App::cpm
      - cpm install -g
      - cpm install Minilla -g
    script:
      - minil test 

release_staging:
    stage: release
    before_script:
      - perl -V
      - cpan install App::cpm
      - cpm install -g
      - cpm install Minilla -g
      - echo "user $CPAN_USER" > ~/.pause
      - echo "password $CPAN_PASSWORD" >> ~/.pause
      - pwd
      - ls -la
    script:
      - pwd
      - minil dist
      - ls -la
      - echo | minil release
      - find / -name WG-API-v0.8.7.tar.gz
    only:
      - build